<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spin the Wheel</title>
  <link
   href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap"
   rel="stylesheet"
  />
  <style>
   * {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
   }
   body {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
   }
   .wrapper {
    width: 100vw;
    max-width: 70vw;
    height: auto;
    justify-items: center;
    align-items: center;
    justify-content: center;
    display: flex;
    flex-flow: row wrap;
    padding: 3em;
    box-shadow: 0 0 10px black;
   }
   .esquerdo {
    width: 48%;
   }
   .container {
    width: 48%;
    position: relative;
   }
   #wheel {
    width: inherit;
    top: 0;
    padding: 0;
   }
   .smeio {
    font-size: 2em;
    color: black;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 10px;
    border-radius: 50%;
    border: 2px solid black;
    z-index: 10;
    width: 70px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
   }
   img {
    position: absolute;
    width: 4em;
    top: 45%;
    right: -8%;
    transform: rotate(90deg);
   }
   #final-value {
    font-size: 1.5em;
    text-align: center;
    margin-top: 1.5em;
    color: #202020;
    font-weight: 500;
   }
   @media screen and (max-width: 768px) {
    .wrapper {
     font-size: 12px;
    }
    img {
     right: -5%;
    }
   }
  </style>
 </head>
 <body>
  <div class="wrapper">
   <div class="esquerdo">
    <p id="final-value">Click On The Spin Button To Start</p>
    <button id="spin-btn">Spin</button>
   </div>
   <div class="container">
    <canvas id="wheel"></canvas>
    <p class="smeio">S</p>
    <img src="wheel_arrow.png" alt="spinner arrow" />
   </div>
  </div>

  <!-- Chart JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <!-- Chart JS Plugin for displaying text over chart -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.1.0/chartjs-plugin-datalabels.min.js"></script>

  <script>
   document.addEventListener('DOMContentLoaded', function () {
    const wheel = document.getElementById('wheel')
    const spinBtn = document.getElementById('spin-btn')
    const finalValue = document.getElementById('final-value')

    // Definindo as cores dos segmentos da roleta
    const pieColors = ['#ffcc00', '#ff9900', '#ff6600', '#cc3300', '#ff0000', '#cc0033']

    // Inicializando o gráfico da roleta com cores e rótulos alinhados
    let myChart = new Chart(wheel, {
     plugins: [ChartDataLabels],
     type: 'pie',
     data: {
      labels: ['NO DISCOUNT', '20% OFF', '42% OFF', '12% OFF', '5% OFF', '33% OFF'],
      datasets: [
       {
        backgroundColor: pieColors,
        data: [16, 16, 16, 16, 16, 16] // Distribuição dos segmentos
       }
      ]
     },
     options: {
      responsive: true,
      animation: { duration: 0 },
      rotation: -90, // Ajuste para alinhar a rotação inicial
      plugins: {
       tooltip: false,
       legend: { display: false },
       datalabels: {
        color: '#ffffff',
        formatter: (value, context) => context.chart.data.labels[context.dataIndex],
        font: { size: 14 },
        anchor: 'end',
        align: 'start',
        rotation: context => {
         // Gera rotação com base no índice do rótulo
         let rotation = (context.dataIndex * 360) / context.chart.data.labels.length + 30
         return rotation
        }
       }
      }
     }
    })

    // Função para sempre exibir "42% OFF"
    const valueGenerator = () => {
     finalValue.innerHTML = `<p>Result: 42% OFF</p>`
     spinBtn.disabled = false
    }

    let count = 0
    let resultValue = 101

    // Evento de clique para girar a roleta
    spinBtn.addEventListener('click', () => {
     spinBtn.disabled = true
     finalValue.innerHTML = `<p>Good Luck!</p>`
     let randomDegree = Math.floor(Math.random() * (355 - 0 + 1) + 0)
     let rotationInterval = window.setInterval(() => {
      myChart.options.rotation = myChart.options.rotation + resultValue
      myChart.update()

      if (myChart.options.rotation >= 360) {
       count += 1
       resultValue -= 5
       myChart.options.rotation = 0
      } else if (count > 15 && myChart.options.rotation == randomDegree) {
       valueGenerator()
       clearInterval(rotationInterval)
       count = 0
       resultValue = 101
      }
     }, 10)
    })
   })
  </script>
 </body>
</html>
